<Window x:Class="QuanLiSanCauLong.LopTrinhBay.ManHinh.KhachHoiVien.frmKhachHoiVien"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Khách hàng & Hội viên" Height="800" Width="1300"
        WindowStartupLocation="CenterScreen" Background="#F6FDF9">
	<Window.Resources>
		<!-- Colors -->
		<SolidColorBrush x:Key="ColBg" Color="#F6FDF9"/>
		<SolidColorBrush x:Key="ColCard" Color="White"/>
		<SolidColorBrush x:Key="ColText" Color="#21382D"/>
		<SolidColorBrush x:Key="ColSub"  Color="#6B8B7A"/>
		<SolidColorBrush x:Key="ColPrimary" Color="#0FBF84"/>
		<SolidColorBrush x:Key="ColAccent" Color="#00B894"/>
		<Style x:Key="Card" TargetType="Border">
			<Setter Property="CornerRadius" Value="16"/>
			<Setter Property="Background" Value="{StaticResource ColCard}"/>
			<Setter Property="Padding" Value="16"/>
			<Setter Property="Margin" Value="8"/>
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect BlurRadius="12" ShadowDepth="0" Opacity="0.12"/>
				</Setter.Value>
			</Setter>
		</Style>
		<!-- Badge -->
		<Style x:Key="Badge" TargetType="Border">
			<Setter Property="CornerRadius" Value="10"/>
			<Setter Property="Padding" Value="4,2"/>
			<Setter Property="Background" Value="#E8FFF5"/>
			<Setter Property="BorderBrush" Value="#0FBF84"/>
			<Setter Property="BorderThickness" Value="1"/>
		</Style>
		<!-- List item button -->
		<Style x:Key="GhostBtn" TargetType="Button">
			<Setter Property="Background" Value="#F0FFFA"/>
			<Setter Property="BorderBrush" Value="#D1F5EA"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="Padding" Value="8,4"/>
			<Setter Property="Margin" Value="4,0"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border CornerRadius="10" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="6,2"/>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="True">
					<Setter Property="Background" Value="#E7FFF6"/>
				</Trigger>
			</Style.Triggers>
		</Style>
		<!-- CollectionView for filtering -->
		<CollectionViewSource x:Key="cvsCustomers" Source="{Binding Customers}" />
	</Window.Resources>

	<Grid Margin="16">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<!-- top bar -->
			<RowDefinition Height="Auto"/>
			<!-- KPI -->
			<RowDefinition Height="Auto"/>
			<!-- search -->
			<RowDefinition/>
			<!-- list -->
		</Grid.RowDefinitions>

		<!-- Top bar -->
		<DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,8">
			<TextBlock Text="Quản lý khách hàng & Hội viên" Foreground="{StaticResource ColText}"
                       FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center" />
			<StackPanel Orientation="Horizontal" DockPanel.Dock="Right" >
				<Button Style="{StaticResource GhostBtn}" Click="BtnAdd_OnClick" Background="#0FBF84" Foreground="White">
					+ Thêm khách hàng
				</Button>
			</StackPanel>
		</DockPanel>

		<!-- KPI cards -->
		<UniformGrid Grid.Row="1" Columns="4" Margin="0,0,0,8">
			<Border Style="{StaticResource Card}">
				<StackPanel>
					<TextBlock Text="Tổng khách hàng" Foreground="{StaticResource ColSub}"/>
					<TextBlock Text="{Binding KpiTongKhach}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ColText}"/>
				</StackPanel>
			</Border>
			<Border Style="{StaticResource Card}">
				<StackPanel>
					<TextBlock Text="Hội viên" Foreground="{StaticResource ColSub}"/>
					<TextBlock Text="{Binding KpiHoiVien}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ColText}"/>
				</StackPanel>
			</Border>
			<Border Style="{StaticResource Card}">
				<StackPanel>
					<TextBlock Text="Tổng điểm tích lũy" Foreground="{StaticResource ColSub}"/>
					<TextBlock Text="{Binding KpiTongDiem}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ColText}"/>
				</StackPanel>
			</Border>
			<Border Style="{StaticResource Card}">
				<StackPanel>
					<TextBlock Text="Khách hàng mới (tháng)" Foreground="{StaticResource ColSub}"/>
					<TextBlock Text="{Binding KpiMoiThang}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource ColText}"/>
				</StackPanel>
			</Border>
		</UniformGrid>

		<!-- Search + filter -->
		<Border Grid.Row="2" Style="{StaticResource Card}" Padding="12">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>
				<TextBox Grid.Column="0" Height="36" Margin="0,0,8,0"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         PlaceholderText="Tìm kiếm theo tên, SĐT, email..." />
				<ToggleButton Grid.Column="1" Margin="4,0" Width="110" Height="36"
                              IsChecked="{Binding FilterAll, Mode=TwoWay}"
                              Content="Tất cả"/>
				<ToggleButton Grid.Column="2" Margin="4,0" Width="110" Height="36"
                              IsChecked="{Binding FilterHoiVien, Mode=TwoWay}"
                              Content="Hội viên"/>
				<ToggleButton Grid.Column="3" Margin="4,0" Width="110" Height="36"
                              IsChecked="{Binding FilterVangLai, Mode=TwoWay}"
                              Content="Vãng lai"/>
			</Grid>
		</Border>

		<!-- List -->
		<Border Grid.Row="3" Style="{StaticResource Card}">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<ItemsControl ItemsSource="{Binding Path=CustomersView}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Border BorderBrush="#EEF6F2" BorderThickness="0,0,0,1" Padding="10">
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="50"/>
										<ColumnDefinition/>
										<ColumnDefinition Width="160"/>
										<ColumnDefinition Width="160"/>
										<ColumnDefinition Width="130"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Avatar -->
									<Border Grid.Column="0" Width="40" Height="40" CornerRadius="20" Background="#E6F9F2" HorizontalAlignment="Center" VerticalAlignment="Center">
										<TextBlock Text="{Binding Initials}" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" Foreground="{StaticResource ColAccent}"/>
									</Border>

									<!-- Name + contact -->
									<StackPanel Grid.Column="1" Margin="8,0" >
										<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
											<TextBlock Text="{Binding TenKH}" FontWeight="SemiBold" Foreground="{StaticResource ColText}" FontSize="14"/>
											<Border Style="{StaticResource Badge}" Margin="8,0,0,0" Background="{Binding BadgeBg}" BorderBrush="{Binding BadgeBorder}">
												<TextBlock Text="{Binding LoaiKH}" Foreground="{Binding BadgeFg}" FontSize="11"/>
											</Border>
										</StackPanel>
										<StackPanel Orientation="Horizontal" Margin="0,2,0,0">
											<TextBlock Text="{Binding SDT}" Foreground="{StaticResource ColSub}" />
											<TextBlock Text="  ·  " Foreground="{StaticResource ColSub}"/>
											<TextBlock Text="{Binding Email}" Foreground="{StaticResource ColSub}"/>
										</StackPanel>
									</StackPanel>

									<!-- Points -->
									<StackPanel Grid.Column="2" HorizontalAlignment="Left">
										<TextBlock Text="Điểm tích lũy" Foreground="{StaticResource ColSub}" FontSize="12"/>
										<TextBlock Text="{Binding DiemTichLuy}" FontWeight="SemiBold" />
									</StackPanel>

									<!-- Stats -->
									<StackPanel Grid.Column="3" HorizontalAlignment="Left">
										<TextBlock Text="Lượt chơi" Foreground="{StaticResource ColSub}" FontSize="12"/>
										<TextBlock Text="{Binding LuotChoi}" FontWeight="SemiBold"/>
									</StackPanel>

									<!-- Spending -->
									<StackPanel Grid.Column="4" HorizontalAlignment="Left">
										<TextBlock Text="Tổng chi tiêu" Foreground="{StaticResource ColSub}" FontSize="12"/>
										<TextBlock Text="{Binding TongChiTieu, StringFormat={}{0:N0}₫}" FontWeight="SemiBold"/>
									</StackPanel>

									<!-- Actions -->
									<StackPanel Grid.Column="5" Orientation="Horizontal" HorizontalAlignment="Right">
										<Button Style="{StaticResource GhostBtn}" Content="Xem" Command="{Binding DataContext.CmdViewDetail, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
										<Button Style="{StaticResource GhostBtn}" Content="Ưu đãi" Command="{Binding DataContext.CmdOffer, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
										<Button Style="{StaticResource GhostBtn}" Content="…"
                                                Command="{Binding DataContext.CmdMore, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</ScrollViewer>
		</Border>
	</Grid>
</Window>
