<Window x:Class="QuanLiSanCauLong.LopTrinhBay.ManHinh.KhoPOS.frmLichSuPOS"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Lịch sử POS"
        WindowStartupLocation="CenterOwner"
        SizeToContent="WidthAndHeight"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <!-- ========== RESOURCES ========== -->
    <Window.Resources>
        <!-- Palette giống frmPhieuThanhToanPOS -->
        <SolidColorBrush x:Key="ColText"   Color="#21382D"/>
        <SolidColorBrush x:Key="ColSub"    Color="#6B7E74"/>
        <SolidColorBrush x:Key="ColBorder" Color="#E5E7EB"/>
        <SolidColorBrush x:Key="ColCard"   Color="White"/>
        <SolidColorBrush x:Key="ColAccent" Color="#15A06D"/>
        <SolidColorBrush x:Key="ColDanger" Color="#EF4444"/>

        <Style x:Key="TitleText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource ColText}"/>
        </Style>

        <Style x:Key="LabelSmall" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource ColSub}"/>
        </Style>

        <!-- Nút primary -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="{StaticResource ColAccent}"/>
            <Setter Property="BorderBrush" Value="{StaticResource ColAccent}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="20,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                CornerRadius="10"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Border.RenderTransform>
                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                            </Border.RenderTransform>
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#0DAA78"/>
                                <Setter TargetName="bd" Property="BorderBrush" Value="#0DAA78"/>
                                <Setter TargetName="bd" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="14"
                                                          ShadowDepth="0"
                                                          Opacity="0.30"
                                                          Color="#0DAA78"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="bd" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="1.03" ScaleY="1.03"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Opacity" Value="0.95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="bd" Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Nút phụ trắng viền xám -->
        <Style x:Key="GhostButton" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource ColText}"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd"
                                CornerRadius="10"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#F3F4F6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Ô nhập có viền + bo góc -->
        <Style x:Key="InputBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="#C7D7D0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Margin" Value="0,2,0,0"/>
        </Style>

        <!-- Nút lọc (xanh) -->
        <Style x:Key="FilterButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Padding" Value="26,8"/>
            <Setter Property="MinWidth" Value="90"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <!-- Hover -->
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.04" ScaleY="1.04"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <!-- Nhấn -->
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.97" ScaleY="0.97"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Nút xóa lọc (trắng viền) -->
        <Style x:Key="ClearFilterButton" TargetType="Button" BasedOn="{StaticResource GhostButton}">
            <Setter Property="Padding" Value="26,8"/>
            <Setter Property="MinWidth" Value="100"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.04" ScaleY="1.04"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.97" ScaleY="0.97"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
            </Style.Triggers>
        </Style>


    </Window.Resources>

    <!-- ========== LAYER NỀN + CARD CHÍNH ========== -->
    <Grid Background="#80000000">
        <Border Width="840"
                Background="{StaticResource ColCard}"
                CornerRadius="18"
                Padding="20"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.35"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Header -->
                    <RowDefinition Height="*"/>
                    <!-- Content -->
                    <RowDefinition Height="Auto"/>
                    <!-- Buttons -->
                </Grid.RowDefinitions>

                <!-- ========== HEADER ========== -->
                <Grid Grid.Row="0" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tiêu đề bên trái -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Lịch sử thanh toán POS"
                                   Style="{StaticResource TitleText}"/>
                        <TextBlock Text="Xem lại hóa đơn đã thanh toán tại quầy POS"
                                   FontSize="12"
                                   Foreground="{StaticResource ColSub}"/>
                    </StackPanel>

                    <!-- Nút đóng sát lề phải -->
                    <Button Grid.Column="1"
                            Content="✕"
                            Width="32" Height="32"
                            Margin="0,0,0,0"   
                            Background="Transparent"
                            BorderBrush="{x:Null}"
                            Foreground="{StaticResource ColSub}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Cursor="Hand"
                            Click="BtnClose_Click"/>
                </Grid>



                <!-- ========== CONTENT ========== -->
                <ScrollViewer Grid.Row="1"
                              Margin="0,4,0,10"
                              VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <!-- ===== BỘ LỌC ===== -->
                        <Border Background="#F9FAFB"
                                BorderBrush="{StaticResource ColBorder}"
                                BorderThickness="1"
                                CornerRadius="14"
                                Padding="12"
                                Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Từ ngày -->
                                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                    <TextBlock Text="Từ ngày"
                                               Style="{StaticResource LabelSmall}"/>
                                    <Border Style="{StaticResource InputBorderStyle}" Width="160">
                                        <DatePicker SelectedDate="{Binding TuNgay}"
                                                    BorderThickness="0"
                                                    Height="24"/>
                                    </Border>
                                </StackPanel>

                                <!-- Đến ngày -->
                                <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                    <TextBlock Text="Đến ngày"
                                               Style="{StaticResource LabelSmall}"/>
                                    <Border Style="{StaticResource InputBorderStyle}" Width="160">
                                        <DatePicker SelectedDate="{Binding DenNgay}"
                                                    BorderThickness="0"
                                                    Height="24"/>
                                    </Border>
                                </StackPanel>

                                <!-- Từ khóa -->
                                <StackPanel Grid.Column="2" Margin="0,0,16,0">
                                    <TextBlock Text="Từ khóa"
                                               Style="{StaticResource LabelSmall}"/>
                                    <Border Style="{StaticResource InputBorderStyle}"
                                            Width="200">
                                        <TextBox Background="Transparent"
                                                 BorderThickness="0"
                                                 FontSize="13"
                                                 Height="24"
                                                 Tag="Mã HĐ / tên KH / SĐT"
                                                 Text="{Binding TuKhoaTim, UpdateSourceTrigger=PropertyChanged}"/>
                                    </Border>
                                </StackPanel>

                                <!-- Nút lọc + xóa lọc -->
                                <StackPanel Grid.Column="3"
                                            Orientation="Horizontal"
                                            VerticalAlignment="Bottom"
                                            Margin="8,0,0,0">
                                    <Button Style="{StaticResource FilterButton}"
                                            Content="Lọc"
                                            Margin="0,0,6,0"
                                            Command="{Binding LocCommand}"/>

                                    <Button Style="{StaticResource ClearFilterButton}"
                                            Content="Xóa lọc"
                                            Command="{Binding XoaLocCommand}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- ===== DANH SÁCH HÓA ĐƠN ===== -->
                        <Border Background="#FFFFFF"
                                BorderBrush="{StaticResource ColBorder}"
                                BorderThickness="1"
                                CornerRadius="14"
                                Padding="10"
                                Margin="0,0,0,10">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                    <TextBlock Text="Danh sách hóa đơn"
                                               FontWeight="SemiBold"
                                               FontSize="14"/>
                                    <Border Background="#ECFDF3"
                                            CornerRadius="999"
                                            Margin="8,0,0,0"
                                            Padding="6,1">
                                        <TextBlock Text="{Binding TongSoHoaDon}"
                                                   FontSize="11"
                                                   Foreground="{StaticResource ColSub}"/>
                                    </Border>
                                </StackPanel>

                                <DataGrid ItemsSource="{Binding DanhSachHoaDon}"
                                          SelectedItem="{Binding HoaDonDangChon}"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          CanUserDeleteRows="False"
                                          IsReadOnly="True"
                                          RowHeaderWidth="0"
                                          ColumnHeaderHeight="30"
                                          MinRowHeight="26"
                                          GridLinesVisibility="None">
                                    <DataGrid.Resources>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#F1F5F9"/>
                                            <Setter Property="Foreground" Value="{StaticResource ColText}"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource ColBorder}"/>
                                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGrid.Resources>

                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mã HĐ"
                                                            Binding="{Binding MaHoaDon}"
                                                            Width="90"/>
                                        <DataGridTextColumn Header="Thời gian"
                                                            Binding="{Binding ThoiGian, StringFormat={}{0:dd/MM/yyyy HH:mm}}"
                                                            Width="140"/>
                                        <DataGridTextColumn Header="Khách hàng"
                                                            Binding="{Binding TenKhach}"
                                                            Width="*"/>
                                        <DataGridTextColumn Header="SĐT"
                                                            Binding="{Binding SoDienThoai}"
                                                            Width="110"/>
                                        <DataGridTextColumn Header="PTTT"
                                                            Binding="{Binding PhuongThucThanhToan}"
                                                            Width="110"/>
                                        <DataGridTextColumn Header="Tổng tiền"
                                                            Binding="{Binding TongTien, StringFormat={}{0:N0}đ}"
                                                            Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>

                        <!-- ===== CHI TIẾT HÓA ĐƠN ===== -->
                        <Border Background="#FFFFFF"
                                BorderBrush="{StaticResource ColBorder}"
                                BorderThickness="1"
                                CornerRadius="14"
                                Padding="10">
                            <StackPanel>

                                <TextBlock Text="Chi tiết hóa đơn"
                                           FontWeight="SemiBold"
                                           FontSize="14"
                                           Margin="0,0,0,6"/>

                                <!-- Thông tin KH + Ghi chú -->
                                <Grid Margin="0,0,0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Khách hàng -->
                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                        <TextBlock Text="Khách hàng"
                                                   Style="{StaticResource LabelSmall}"/>
                                        <Border Style="{StaticResource InputBorderStyle}">
                                            <TextBlock Text="{Binding HoaDonDangChon.TenKhach}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       TextWrapping="Wrap"/>
                                        </Border>
                                    </StackPanel>

                                    <!-- Ghi chú -->
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Ghi chú"
                                                   Style="{StaticResource LabelSmall}"/>
                                        <Border Style="{StaticResource InputBorderStyle}">
                                            <TextBlock Text="{Binding HoaDonDangChon.GhiChu}"
                                                       FontSize="13"
                                                       TextWrapping="Wrap"/>
                                        </Border>
                                    </StackPanel>
                                </Grid>

                                <!-- Lưới chi tiết -->
                                <DataGrid ItemsSource="{Binding ChiTietHoaDon}"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          CanUserDeleteRows="False"
                                          IsReadOnly="True"
                                          RowHeaderWidth="0"
                                          ColumnHeaderHeight="28"
                                          MinRowHeight="26"
                                          GridLinesVisibility="None"
                                          Margin="0,0,0,6">
                                    <DataGrid.Resources>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#F1F5F9"/>
                                            <Setter Property="Foreground" Value="{StaticResource ColText}"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="BorderBrush" Value="{StaticResource ColBorder}"/>
                                            <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                            <Setter Property="Padding" Value="8,4"/>
                                        </Style>
                                    </DataGrid.Resources>

                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Sản phẩm" Binding="{Binding TenHang}" Width="*"/>
                                        <DataGridTextColumn Header="ĐVT" Binding="{Binding DVT}" Width="80"/>
                                        <DataGridTextColumn Header="SL" Binding="{Binding SoLuong}" Width="60"/>
                                        <DataGridTextColumn Header="Đơn giá"
                                                            Binding="{Binding DonGia, StringFormat={}{0:N0}đ}"
                                                            Width="110"/>
                                        <DataGridTextColumn Header="Thành tiền"
                                                            Binding="{Binding ThanhTien, StringFormat={}{0:N0}đ}"
                                                            Width="120"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Tổng tiền -->
                                <DockPanel Margin="0,4,0,0">
                                    <TextBlock Text="Tổng tiền hóa đơn:"
                                               Foreground="{StaticResource ColSub}"
                                               FontSize="13"
                                               DockPanel.Dock="Left"
                                               VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding HoaDonDangChon.TongTien, StringFormat={}{0:N0}đ}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource ColAccent}"
                                               DockPanel.Dock="Right"
                                               VerticalAlignment="Center"/>
                                </DockPanel>
                            </StackPanel>
                        </Border>

                    </StackPanel>
                </ScrollViewer>

                <!-- ========== BUTTONS ========== -->
                <Grid Grid.Row="2" Margin="0,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Style="{StaticResource GhostButton}"
                            Content="In lại hóa đơn"
                            Margin="0,0,4,0"
                            Height="40"
                            Command="{Binding InLaiHoaDonCommand}"/>

                    <Button Grid.Column="1"
                            Style="{StaticResource PrimaryButton}"
                            Content="Đóng"
                            Margin="4,0,0,0"
                            Height="40"
                            Click="BtnClose_Click"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
