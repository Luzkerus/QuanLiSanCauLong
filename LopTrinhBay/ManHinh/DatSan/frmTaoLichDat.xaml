<Window x:Class="QuanLiSanCauLong.LopTrinhBay.ManHinh.DatSan.frmTaoLichDat"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Tạo đơn đặt sân"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        SizeToContent="WidthAndHeight"
        WindowStyle="None"
        AllowsTransparency="True"
        Width="550" Height="600"
        Background="Transparent"
        MinWidth="550" MinHeight="600"
        MaxWidth="980">

    <!-- ===== Colors / Converters ===== -->
    <Window.Resources>
        <SolidColorBrush x:Key="ColText"   Color="#21382D"/>
        <SolidColorBrush x:Key="ColSub"    Color="#6B7E74"/>
        <SolidColorBrush x:Key="ColBorder" Color="#E1F0E9"/>
        <SolidColorBrush x:Key="ColCard"   Color="White"/>
        <SolidColorBrush x:Key="ColAccent" Color="#15A06D"/>

        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Watermark (placeholder) cho TextBox: dùng thuộc tính Tag làm chữ gợi ý -->
        <Style x:Key="WatermarkTextBox" TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <ScrollViewer x:Name="PART_ContentHost"/>
                            <TextBlock x:Name="Watermark"
                                       Text="{TemplateBinding Tag}"
                                       Foreground="#9AA7A0"
                                       Margin="4,0,0,0"
                                       IsHitTestVisible="False"
                                       VerticalAlignment="Center"
                                       Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="Text" Value="">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="Text" Value="{x:Null}">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Watermark" Property="Visibility" Value="Collapsed"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Badge ngày lễ -->
        <Style x:Key="HolidayBadge" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="#FFF0F0"/>
            <Setter Property="BorderBrush" Value="#FFC7C7"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Ô tiền -->
        <Style x:Key="MoneyCell" TargetType="TextBlock">
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#0D7049"/>
        </Style>

        <!-- Footer Borders (hover đậm hơn, KHÔNG dùng IsPressed) -->
        <Style x:Key="FooterGhostBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Background" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#C5F3DF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F2FFFA"/>
                    <Setter Property="BorderBrush" Value="#8FEBD1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FooterGrayBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Background" Value="#F3F5F4"/>
            <Setter Property="BorderBrush" Value="#E7ECEA"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E9ECEB"/>
                    <Setter Property="BorderBrush" Value="#DADFDD"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="FooterPrimaryBorder" TargetType="Border">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Height" Value="38"/>
            <Setter Property="Background" Value="{StaticResource ColAccent}"/>
            <Setter Property="BorderBrush" Value="#119A67"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0E8F64"/>
                    <Setter Property="BorderBrush" Value="#0B7D57"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <Border CornerRadius="14" Background="{StaticResource ColCard}" BorderBrush="#D7EAE2" BorderThickness="1" Padding="20" Margin="6">
        <Border.Effect>
            <DropShadowEffect BlurRadius="18" ShadowDepth="2" Opacity="0.35"/>
        </Border.Effect>

        <Grid MinWidth="440">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ===== Header ===== -->
            <!-- ===== Header (có Minimize & Close) ===== -->
            <Border Grid.Row="0" Background="White" CornerRadius="10,10,0,0"
        BorderBrush="{StaticResource ColBorder}" BorderThickness="0,0,0,1">
                <Grid MouseDown="Header_MouseDown">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tiêu đề -->
                    <TextBlock Text="Tạo đơn đặt sân mới" FontWeight="Bold" FontSize="16"
                   Foreground="{StaticResource ColText}" VerticalAlignment="Center" Margin="12,8"/>

                    <!-- Nút Minimize (đơn giản, bo nhẹ) -->
                    <Button Grid.Column="1" Width="36" Height="28" Margin="0,6,6,6"
                Click="BtnMinimize_Click"
                ToolTip="Thu nhỏ"
                Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="#CBD5E1"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Foreground" Value="#334155"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border CornerRadius="6"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Background="{TemplateBinding Background}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#E0F2FE"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter Property="Background" Value="#BFDBFE"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <TextBlock Text="—" FontSize="14" FontWeight="Bold"
                       VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>

                    <!-- Nút Close (đơn giản, bo nhẹ) -->
                    <Button Grid.Column="2" Width="36" Height="28" Margin="0,6,10,6"
                Click="BtnClose_Click"
                ToolTip="Đóng"
                Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="#FCA5A5"/>
                                <Setter Property="BorderThickness" Value="1"/>
                                <Setter Property="Foreground" Value="#B91C1C"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border CornerRadius="6"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Background="{TemplateBinding Background}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#FEE2E2"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter Property="Background" Value="#FCA5A5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <TextBlock Text="✕" FontSize="13" FontWeight="Bold"
                       VerticalAlignment="Center" HorizontalAlignment="Center"/>
                    </Button>
                </Grid>
            </Border>

            <!-- ===== Body ===== -->
            <StackPanel Grid.Row="1" DataContext="{Binding}">
                <!-- Thông tin KH -->
                <Border CornerRadius="10" BorderBrush="#CFE4FF" BorderThickness="1"
                        Background="#EDF6FF" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Thông tin khách hàng" FontWeight="SemiBold" Foreground="{StaticResource ColText}" Margin="0,0,0,6"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="12"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Tên khách hàng*" Margin="2,0,0,4"/>
                                <Border CornerRadius="10" BorderBrush="#D7EAFB" BorderThickness="1" Background="White" Padding="8,6">
                                    <TextBox BorderThickness="0" Background="Transparent" Text="{Binding TenKH, UpdateSourceTrigger=PropertyChanged}"/>
                                </Border>
                                <TextBlock Text="Số điện thoại*" Margin="2,0,0,4"/>
                                <Border CornerRadius="10" BorderBrush="#D7EAFB" BorderThickness="1" Background="White" Padding="8,6">
                                    <TextBox BorderThickness="0" Background="Transparent" Text="{Binding SDT, UpdateSourceTrigger=PropertyChanged}"/>
                                </Border>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Email" Margin="2,0,0,4"/>
                                <Border CornerRadius="10" BorderBrush="#D7EAFB" BorderThickness="1" Background="White" Padding="8,6">
                                    <TextBox BorderThickness="0" Background="Transparent" Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}"/>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Hàng 1: Ngày + Sân + Badge ngày lễ -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Ngày đặt -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Ngày đặt" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="4,0">
                            <DatePicker SelectedDate="{Binding NgayDat, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        BorderThickness="0" Height="38"/>
                        </Border>
                    </StackPanel>

                    <!-- Sân -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="Sân" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="4,2">
                            <ComboBox MinHeight="34"
                                      ItemsSource="{Binding DanhSachSan}"
                                      SelectedItem="{Binding SanDangChon}"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Hàng 2: Giờ bắt đầu/kết thúc (dùng WatermarkTextBox) -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Giờ bắt đầu" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="8,6">
                            <TextBox Text="{Binding GioBatDau}"
                                     Style="{StaticResource WatermarkTextBox}"
                                     Tag="--:--" 
                                     BorderThickness="0" Background="Transparent"/>
                        </Border>
                    </StackPanel>

                    <StackPanel Grid.Column="2">
                        <TextBlock Text="Giờ kết thúc" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="8,6">
                            <TextBox Text="{Binding GioKetThuc}"
                                     Style="{StaticResource WatermarkTextBox}"
                                     Tag="--:--" 
                                     BorderThickness="0" Background="Transparent"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Hàng 3: Giá gốc / Giá lễ / Thành tiền ước tính -->
                <Grid Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Giá gốc (VNĐ/giờ)" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="8,6">
                            <TextBlock Text="{Binding GiaGoc, StringFormat={}{0:N0}}"/>
                        </Border>
                    </StackPanel>

                    <StackPanel Grid.Column="2">
                        <TextBlock Text="Giá ngày lễ (VNĐ/giờ)" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="{StaticResource ColBorder}" BorderThickness="1" Background="#FFFFFF" Padding="8,6">
                            <TextBlock Text="{Binding GiaNgayLe, StringFormat={}{0:N0}, TargetNullValue=—}"/>
                        </Border>
                    </StackPanel>

                    <StackPanel Grid.Column="4">
                        <TextBlock Text="Thành tiền (ước tính)" Margin="2,0,0,4"/>
                        <Border CornerRadius="10" BorderBrush="#C5F3DF" BorderThickness="1" Background="#F6FFFB" Padding="8,6">
                            <TextBlock Style="{StaticResource MoneyCell}"
                                       Text="{Binding ThanhTienUocTinh, StringFormat={}{0:N0} đ}"/>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Chi tiết đặt nhiều sân (DataGrid) -->
                <Border CornerRadius="10" BorderBrush="#F3E5B8" BorderThickness="1" Background="#FFF7DB" Padding="10" Margin="0,0,0,10">
                    <StackPanel>
                        <DockPanel Margin="0,0,0,6">
                            <TextBlock Text="Chi tiết giỏ đặt nhiều sân" FontWeight="SemiBold" Foreground="{StaticResource ColText}" DockPanel.Dock="Left"/>
                            <TextBlock Text="{Binding GioCount, StringFormat={}{0} sân}" Foreground="{StaticResource ColSub}" DockPanel.Dock="Right"/>
                        </DockPanel>

                        <DataGrid ItemsSource="{Binding GioDat}" AutoGenerateColumns="False" HeadersVisibility="Column"
                                  CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                                  BorderBrush="#F1E9C7" BorderThickness="1" RowBackground="White" AlternatingRowBackground="#FFF3D6"
                                  Margin="0,4,0,8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Sân" Binding="{Binding TenSan}" Width="*" />
                                <DataGridTextColumn Header="Ngày" Binding="{Binding Ngay, StringFormat={}{0:dd/MM/yyyy}}" Width="120"/>
                                <DataGridTextColumn Header="Bắt đầu" Binding="{Binding GioBatDau}" Width="90"/>
                                <DataGridTextColumn Header="Kết thúc" Binding="{Binding GioKetThuc}" Width="90"/>
                                <DataGridTextColumn Header="Giá gốc" Binding="{Binding GiaGoc, StringFormat={}{0:N0}}" Width="120"/>
                                <DataGridTextColumn Header="Giá lễ" Binding="{Binding GiaNgayLe, StringFormat={}{0:N0}}" Width="120"/>
                                <DataGridTextColumn Header="Thành tiền" Binding="{Binding ThanhTien, StringFormat={}{0:N0} đ}" Width="140"/>
                                <DataGridTemplateColumn Header="">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Content="✕" Padding="6,2" Cursor="Hand"
                                                    Command="{Binding DataContext.XoaDongGioDatCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Tổng giỏ -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="192*"/>
                                <ColumnDefinition Width="613*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Tổng tiền giỏ (ước tính):" VerticalAlignment="Center" Foreground="{StaticResource ColSub}" Grid.ColumnSpan="2"/>
                            <TextBlock Grid.Column="2" Style="{StaticResource MoneyCell}"
                                       Text="{Binding TongTienGio, StringFormat={}{0:N0} đ}" HorizontalAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Tổng tiền dự kiến -->
                <Border CornerRadius="12" Padding="12" BorderBrush="{StaticResource ColBorder}" BorderThickness="1">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#F0FFF6" Offset="0"/>
                            <GradientStop Color="#FFFFFF" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Tổng tiền dự kiến:" Foreground="{StaticResource ColSub}" VerticalAlignment="Center"/>
                        <TextBlock Grid.Column="1" Text="{Binding TongTien, StringFormat={}{0:N0}đ}"
                                   Foreground="#15A06D" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </StackPanel>

            <!-- ===== Footer ===== -->
            <Grid Grid.Row="2" Margin="6,12,6,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="190"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Thêm vào giỏ đặt -->
                <Border Grid.Column="1"
            Style="{StaticResource FooterGhostBorder}"
            Margin="48,0,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="➕" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Thêm vào giỏ đặt" VerticalAlignment="Center"
                       Foreground="#0D7049" FontWeight="SemiBold"/>
                    </StackPanel>
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick"
                          Command="{Binding ThemVaoGioCommand}"/>
                    </Border.InputBindings>
                </Border>

                <!-- Hủy -->
                <Border Grid.Column="3"
            Style="{StaticResource FooterGrayBorder}"
            Padding="16,0">
                    <TextBlock Text="Hủy" VerticalAlignment="Center"
                   HorizontalAlignment="Center" Foreground="#4A5A55"/>
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick"
                          Command="{Binding HuyCommand}"/>
                    </Border.InputBindings>
                </Border>

                <!-- Tạo đơn -->
                <Border Grid.Column="5"
            Style="{StaticResource FooterPrimaryBorder}"
            Padding="12,0"
            MinWidth="140">
                    <DockPanel LastChildFill="False">
                        <TextBlock Text="&#xE8FB;" FontFamily="Segoe MDL2 Assets"
                       Foreground="White" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <TextBlock Text="Tạo đơn" Foreground="White"
                       FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <Border DockPanel.Dock="Right" Background="#FFFFFF22" BorderBrush="#FFFFFF55" BorderThickness="1"
                    CornerRadius="10" Padding="8,2" VerticalAlignment="Center">
                            <TextBlock Text="{Binding GioCount, StringFormat={}{0} sân, TargetNullValue=0 sân, FallbackValue=0 sân}"
                           Foreground="Black" FontSize="12" FontWeight="SemiBold"/>
                        </Border>
                    </DockPanel>
                    <Border.ToolTip>
                        <TextBlock Text="{Binding GioCount, StringFormat={}{0} sân trong giỏ, TargetNullValue=Chưa có sân}"/>
                    </Border.ToolTip>
                    <Border.InputBindings>
                        <MouseBinding MouseAction="LeftClick"
                          Command="{Binding TaoDonCommand}"/>
                    </Border.InputBindings>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
