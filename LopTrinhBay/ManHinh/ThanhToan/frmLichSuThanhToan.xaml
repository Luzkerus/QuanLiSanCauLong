<Window x:Class="QuanLiSanCauLong.LopTrinhBay.ManHinh.ThanhToan.frmLichSuThanhToan"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        mc:Ignorable="d"
        Title="Lịch sử thanh toán hóa đơn"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        SizeToContent="Manual"
        WindowStyle="None"
        AllowsTransparency="False"
        Background="Transparent"
        MinWidth="820" MinHeight="560"
        d:DesignWidth="880" d:DesignHeight="760">

    <!-- WindowChrome: cho kéo thả & resize chuẩn -->
    <shell:WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="40"
                            ResizeBorderThickness="8"
                            CornerRadius="12"
                            GlassFrameThickness="0"
                            UseAeroCaptionButtons="False"/>
    </shell:WindowChrome.WindowChrome>

    <!-- Khung ngoài -->
    <Border CornerRadius="12" Background="#F6FDF9" Padding="8"
            BorderBrush="#E1F0E9" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.10"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Header -->
                <RowDefinition Height="*"/>
                <!-- Body -->
            </Grid.RowDefinitions>

            <!-- ================= RESOURCES ================= -->
            <Grid.Resources>
                <!-- Palette -->
                <SolidColorBrush x:Key="ColText"   Color="#21382D"/>
                <SolidColorBrush x:Key="ColSub"    Color="#6B7E74"/>
                <SolidColorBrush x:Key="ColCard"   Color="White"/>
                <SolidColorBrush x:Key="ColLine"   Color="#E1F0E9"/>
                <SolidColorBrush x:Key="ColAccent" Color="#15A06D"/>

                <!-- Button styles chung -->
                <Style x:Key="BtnBase" TargetType="Button">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="#475569"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Padding" Value="14,10"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="MinWidth" Value="120"/>
                    <Setter Property="Height" Value="40"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="bd" CornerRadius="10"
                                        Background="{TemplateBinding Background}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="4,0"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="bd" Property="Opacity" Value="0.9"/>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter TargetName="bd" Property="Opacity" Value="0.85"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
                <Style x:Key="BtnPrimary" BasedOn="{StaticResource BtnBase}" TargetType="Button">
                    <Setter Property="Background" Value="#15A06D"/>
                </Style>
                <Style x:Key="BtnInfo" BasedOn="{StaticResource BtnBase}" TargetType="Button">
                    <Setter Property="Background" Value="#2563EB"/>
                </Style>
                <Style x:Key="BtnSuccess" BasedOn="{StaticResource BtnBase}" TargetType="Button">
                    <Setter Property="Background" Value="#16A34A"/>
                </Style>
                <Style x:Key="BtnDanger" BasedOn="{StaticResource BtnBase}" TargetType="Button">
                    <Setter Property="Background" Value="#E11D48"/>
                </Style>
                <Style x:Key="BtnNeutral" BasedOn="{StaticResource BtnBase}" TargetType="Button">
                    <Setter Property="Background" Value="#334155"/>
                </Style>

                <!-- Card -->
                <Style x:Key="Card" TargetType="Border">
                    <Setter Property="Background" Value="{StaticResource ColCard}"/>
                    <Setter Property="CornerRadius" Value="12"/>
                    <Setter Property="Padding" Value="14"/>
                    <Setter Property="Margin" Value="0,0,12,0"/>
                    <Setter Property="BorderBrush" Value="{StaticResource ColLine}"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Style>

                <!-- DataGrid -->
                <Style TargetType="DataGrid">
                    <Setter Property="RowHeight" Value="36"/>
                    <Setter Property="GridLinesVisibility" Value="Horizontal"/>
                    <Setter Property="HeadersVisibility" Value="Column"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="AutoGenerateColumns" Value="False"/>
                    <Setter Property="CanUserAddRows" Value="False"/>
                    <Setter Property="CanUserDeleteRows" Value="False"/>
                </Style>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#F7FBF9"/>
                    <Setter Property="Foreground" Value="{StaticResource ColText}"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="BorderBrush" Value="{StaticResource ColLine}"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                    <Setter Property="Padding" Value="8,6"/>
                </Style>

                <!-- ===== Nút header (bo tròn nhẹ, KHÔNG TemplateBinding ngoài template) ===== -->
                <Style x:Key="WinBtnBase" TargetType="Button">
                    <Setter Property="Width" Value="36"/>
                    <Setter Property="Height" Value="28"/>
                    <Setter Property="Margin" Value="0,6,6,6"/>
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderBrush" Value="#CBD5E1"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Foreground" Value="#334155"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="bd" CornerRadius="6"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="bd" Property="Background" Value="#F1F5F9"/>
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter TargetName="bd" Property="Background" Value="#E2E8F0"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
                <Style x:Key="WinBtnMin" TargetType="Button" BasedOn="{StaticResource WinBtnBase}">
                    <Setter Property="BorderBrush" Value="#CBD5E1"/>
                    <Setter Property="Foreground"  Value="#334155"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#E0F2FE"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="Background" Value="#BFDBFE"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
                <Style x:Key="WinBtnClose" TargetType="Button" BasedOn="{StaticResource WinBtnBase}">
                    <Setter Property="BorderBrush" Value="#FCA5A5"/>
                    <Setter Property="Foreground"  Value="#B91C1C"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#FEE2E2"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="Background" Value="#FCA5A5"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Grid.Resources>

            <!-- ================= HEADER ================= -->
            <!-- Vùng trống của header là caption kéo thả nhờ WindowChrome -->
            <Grid Grid.Row="0" Height="40" Background="White" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Caption (không nhận hit test để kéo) -->
                <Grid shell:WindowChrome.IsHitTestVisibleInChrome="False">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="12,0">
                        <TextBlock Text="Lịch sử thanh toán hóa đơn"
                                   FontSize="18" FontWeight="SemiBold"
                                   Foreground="{StaticResource ColText}" />
                    </StackPanel>
                </Grid>

                <!-- Close -->
                <Button Grid.Column="2" Margin="0,6,10,6"
                        shell:WindowChrome.IsHitTestVisibleInChrome="True"
                        Style="{StaticResource WinBtnClose}"
                        Click="BtnClose_Click"
                        ToolTip="Đóng">
                    <TextBlock Text="✕" FontSize="13" FontWeight="Bold"/>
                </Button>
            </Grid>

            <!-- ================= BODY (responsive) ================= -->
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Filter -->
                    <RowDefinition Height="*"/>
                    <!-- Data -->
                </Grid.RowDefinitions>

                <!-- Filter -->
                <Border Grid.Row="0" Style="{StaticResource Card}" Margin="0,0,0,12">
                    <DockPanel LastChildFill="True">
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <StackPanel Margin="0,0,12,0">
                                <TextBlock Text="Từ ngày" Foreground="{StaticResource ColSub}" Margin="0,0,0,2"/>
                                <DatePicker  x:Name="dpTuNgay" MinWidth="150" Height="30"
                                            SelectedDate="{Binding TuNgay}" SelectedDateFormat="Short"/>
                            </StackPanel>
                            <StackPanel>
                                <TextBlock Text="Đến ngày" Foreground="{StaticResource ColSub}" Margin="0,0,0,2"/>
                                <DatePicker x:Name="dpDenNgay" MinWidth="150" Height="30"
                                            SelectedDate="{Binding DenNgay}" SelectedDateFormat="Short"/>
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="8,0,0,0" VerticalAlignment="Bottom" DockPanel.Dock="Right">
                            <Button Content="Xem"    Click="BtnXem_Click"  Style="{StaticResource BtnPrimary}" Margin="0,8,8,0"/>
                            <Button Content="Làm mới"   Click="btnLamMoi_Click" Style="{StaticResource BtnInfo}"    Margin="0,8,8,0"/>
                            <Button Content="Xuất Excel" Click="btnXuat_Click" Style="{StaticResource BtnSuccess}" Margin="0,8,8,0"/>
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!-- DataGrid -->
                <Border Grid.Row="1" Background="{StaticResource ColCard}" CornerRadius="12"
                        Padding="10" BorderBrush="{StaticResource ColLine}" BorderThickness="1">
                    <DataGrid ItemsSource="{Binding Invoices}" SelectedItem="{Binding SelectedInvoice}" x:Name="dgvLichSuThanhToan"
                              HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Số HĐ"           Binding="{Binding SoHD}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="Ngày lập"        Binding="{Binding NgayLap, StringFormat={}{0:dd/MM/yyyy HH:mm}}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="Khách hàng"      Binding="{Binding TenKH}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="SĐT"             Binding="{Binding SDT}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="Phương thức"     Binding="{Binding PhuongThuc}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="Tổng tiền sân"      Binding="{Binding TongTienSan}" Width="*" MinWidth="10"/>
                           
                            <DataGridTextColumn Header="Tổng tiền thuê vợt"      Binding="{Binding TongTienThueVot}" Width="*" MinWidth="10"/>
                            <DataGridTextColumn Header="Tổng thanh toán" Binding="{Binding TongTien, StringFormat={}{0:N0} ₫}" Width="*" MinWidth="10"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
